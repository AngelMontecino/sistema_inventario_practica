{% extends 'base.html' %}

{% block title %}Cierre de Caja Exitoso{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <fluent-card class="p-5 text-center">
            <div class="mb-4">
                <i class='bx bxs-check-circle text-success' style="font-size: 5rem;"></i>
                <h2 class="fw-bold mt-2">Caja Cerrada Exitosamente</h2>
                <p class="text-muted">El turno se ha cerrado correctamente y los registros han sido guardados.</p>
            </div>

            <div class="row mb-5 text-start">
                <div class="col-md-6 border-end">
                     <ul class="list-group list-group-flush small">
                        <li class="list-group-item d-flex justify-content-between bg-transparent ps-0">
                            <strong>Saldo Inicial:</strong>
                            <span>${{ resultado.saldo_inicial }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between bg-transparent ps-0">
                            <strong>Ventas:</strong>
                            <span class="text-success fw-bold">+ ${{ resultado.ingresos_ventas }}</span>
                        </li>
                         <li class="list-group-item d-flex justify-content-between bg-transparent ps-0">
                            <strong>Compras/Gastos:</strong>
                            <span class="text-danger fw-bold">- ${{ resultado.egresos_compras }}</span>
                        </li>
                    </ul>
                </div>
                <div class="col-md-6 ps-md-4">
                    <ul class="list-group list-group-flush small">
                         <li class="list-group-item d-flex justify-content-between bg-light rounded px-2 mb-1">
                            <strong>Saldo Te√≥rico:</strong>
                            <span class="fw-bold">${{ resultado.saldo_teorico }}</span>
                        </li>
                         <li class="list-group-item d-flex justify-content-between bg-transparent ps-0">
                            <strong>Dinero Contado:</strong>
                            <span class="fw-bold">${{ resultado.monto_real }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between bg-transparent ps-0">
                            <strong>Diferencia:</strong>
                            <span class="{% if resultado.diferencia < 0 %}text-danger{% elif resultado.diferencia > 0 %}text-success{% else %}text-muted{% endif %} fw-bold">
                                ${{ resultado.diferencia }}
                            </span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Reporte de Productos -->
            {% if resultado.productos %}
            <div class="mb-5 text-start">
                <h5 class="fw-bold mb-3 border-bottom pb-2">Resumen de Productos</h5>
                <div class="table-responsive">
                    <table class="table table-sm table-striped table-hover small">
                        <thead class="table-light">
                            <tr>
                                <th>Producto</th>
                                <th class="text-center">Cant. Vendida</th>
                                <th class="text-end">Total Ventas</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for prod in resultado.productos %}
                            {% if prod.cantidad_ventas > 0 %}
                            <tr>
                                <td>{{ prod.nombre }} <small class="text-muted">({{ prod.codigo_barras|default:'-' }})</small></td>
                                <td class="text-center">{{ prod.cantidad_ventas }}</td>
                                <td class="text-end">${{ prod.total_ventas }}</td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                            <!-- Mostrar compras si existen -->
                             {% for prod in resultado.productos %}
                            {% if prod.cantidad_compras > 0 %}
                            <tr class="">
                                <td>{{ prod.nombre }} <small class="text-muted">(Compra)</small></td>
                                <td class="text-center">{{ prod.cantidad_compras }}</td>
                                <td class="text-end text-danger">-${{ prod.total_compras }}</td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

            <div class="d-grid gap-2 col-md-8 mx-auto">
                <fluent-button appearance="accent" onclick="window.location.href='{% url 'gestion_caja' %}'">
                    Volver al Panel de Caja
                </fluent-button>
            </div>
        </fluent-card>
    </div>
</div>
{% endblock %}
