{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card shadow">
            <div class="card-header bg-white">
                <h4 class="mb-0">{{ titulo }}</h4>
            </div>
            <div class="card-body">
                {% if error %}
                <div class="alert alert-danger">{{ error }}</div>
                {% endif %}

                <form method="post">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="rut" class="form-label">RUT / Identificador</label>
                        <input type="text" class="form-control" id="rut" name="rut" 
                               value="{{ tercero.rut|default:'' }}" required>
                        <div class="form-text">Debe ser único.</div>
                    </div>

                    <div class="mb-3">
                        <label for="nombre" class="form-label">Razón Social / Nombre</label>
                        <input type="text" class="form-control" id="nombre" name="nombre" 
                               value="{{ tercero.nombre|default:'' }}" required>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" 
                                   value="{{ tercero.email|default:'' }}">
                        </div>
                        <div class="col-md-6">
                            <label for="telefono" class="form-label">Teléfono</label>
                            <input type="text" class="form-control" id="telefono" name="telefono" 
                                   value="{{ tercero.telefono|default:'' }}">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="direccion" class="form-label">Dirección</label>
                        <textarea class="form-control" id="direccion" name="direccion" rows="2">{{ tercero.direccion|default:'' }}</textarea>
                    </div>

                    <div class="mb-4">
                        <label class="form-label d-block">Tipo de Relación (Marcar al menos uno)</label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="es_cliente" name="es_cliente" 
                                   {% if tercero.es_cliente %}checked{% endif %}>
                            <label class="form-check-label" for="es_cliente">Es Cliente</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="es_proveedor" name="es_proveedor" 
                                   {% if tercero.es_proveedor %}checked{% endif %}>
                            <label class="form-check-label" for="es_proveedor">Es Proveedor</label>
                        </div>
                    </div>

                    <div class="d-grid gap-2 d-md-block text-end">
                        <a href="{% url 'lista_terceros' %}" class="btn btn-outline-secondary">Cancelar</a>
                        <button type="submit" class="btn btn-primary px-4">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const rutInput = document.getElementById("rut");
        
        rutInput.addEventListener("input", function(e) {
            let value = e.target.value.replace(/[^0-9kK]/g, ""); // Eliminar caracteres inválidos
            
            if (value.length > 1) {
                // Separar cuerpo y dígito verificador
                const dv = value.slice(-1);
                let cuerpo = value.slice(0, -1);
                
                // Formatear cuerpo con puntos
                cuerpo = parseInt(cuerpo).toLocaleString("es-CL").replace(/,/g, ".");
                
                // Unir
                e.target.value = `${cuerpo}-${dv}`;
            } else {
                e.target.value = value;
            }
        });
        
        
        rutInput.addEventListener("blur", function(e) {
          
        });
    });
</script>
{% endblock %}
